<!DOCTYPE html>
<html lang="en-US"> <head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Rules - Panther Docs - Development</title> <meta name="Description" content="Panther Rules - processing"> <link rel="shortcut icon" href="/sample-docs-development/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/sample-docs-development/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/sample-docs-development/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/sample-docs-development/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Rules | Panther Docs - Development</title> <meta name="generator" content="Jekyll v3.9.0"> <meta property="og:title" content="Rules"> <meta property="og:locale" content="en_US"> <meta name="description" content="Panther Rules - processing"> <meta property="og:description" content="Panther Rules - processing"> <link rel="canonical" href="https://vinceoa.github.io/sample-docs-development/panther/rules"> <meta property="og:url" content="https://vinceoa.github.io/sample-docs-development/panther/rules"> <meta property="og:site_name" content="Panther Docs - Development"> <meta property="og:image" content="https://vinceoa.github.io/sample-docs-development/img/panther_logo_border.png"> <meta name="twitter:card" content="summary_large_image"> <meta property="twitter:image" content="https://vinceoa.github.io/sample-docs-development/img/panther_logo_border.png"> <meta property="twitter:title" content="Rules"> <meta name="twitter:site" content="@"> <script type="application/ld+json"> {"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://vinceoa.github.io/sample-docs-development/img/panther_logo_thin.png"}},"description":"Panther Rules - processing","headline":"Rules","@type":"WebPage","url":"https://vinceoa.github.io/sample-docs-development/panther/rules","image":"https://vinceoa.github.io/sample-docs-development/img/panther_logo_border.png","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> <meta name="openans.product" content="Panther"> <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet"> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewbox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewbox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewbox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewbox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewbox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="https://vinceoa.github.io/sample-docs-development/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <div style="padding-right: 10px;"> <a href="https://github.com/OpenAnswers"> <i class="icon-github"></i> </a> <a href="https://twitter.com/PantherMonitor1"> <i class="icon-twitter"></i> </a> </div> <a href="#" id="menu-button" class="site-button"> <svg viewbox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list">
<li class="nav-list-item"><a href="https://vinceoa.github.io/sample-docs-development/" class="nav-list-link">Home</a></li>
<li class="nav-list-item"><a href="https://vinceoa.github.io/sample-docs-development/panther/about" class="nav-list-link">About</a></li>
<li class="nav-list-item"><a href="https://vinceoa.github.io/sample-docs-development/panther/getting-started" class="nav-list-link">Getting Started</a></li>
<li class="nav-list-item"><a href="https://vinceoa.github.io/sample-docs-development/panther/config" class="nav-list-link">Client Configuration</a></li>
<li class="nav-list-item"><a href="https://vinceoa.github.io/sample-docs-development/panther/dashboard" class="nav-list-link">Dashboard</a></li>
<li class="nav-list-item">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://vinceoa.github.io/sample-docs-development/panther/console" class="nav-list-link">Console</a><ul class="nav-list "><li class="nav-list-item "><a href="https://vinceoa.github.io/sample-docs-development/panther/console/shortcuts" class="nav-list-link">Keyboard Shortcuts</a></li></ul>
</li>
<li class="nav-list-item active">
<a href="#" class="nav-list-expander"><svg viewbox="0 0 24 24"><use xlink:href="#svg-arrow-right"></use></svg></a><a href="https://vinceoa.github.io/sample-docs-development/panther/rules" class="nav-list-link active">Rules</a><ul class="nav-list ">
<li class="nav-list-item "><a href="https://vinceoa.github.io/sample-docs-development/panther/rules/agent" class="nav-list-link">Agent rules</a></li>
<li class="nav-list-item "><a href="https://vinceoa.github.io/sample-docs-development/panther/rules/global" class="nav-list-link">Server Global rules</a></li>
<li class="nav-list-item "><a href="https://vinceoa.github.io/sample-docs-development/panther/rules/group" class="nav-list-link">Server Group rules</a></li>
<li class="nav-list-item "><a href="https://vinceoa.github.io/sample-docs-development/panther/rules/schedules" class="nav-list-link">Event schedule selection</a></li>
<li class="nav-list-item "><a href="https://vinceoa.github.io/sample-docs-development/panther/rules/selection" class="nav-list-link">Event selection</a></li>
<li class="nav-list-item "><a href="https://vinceoa.github.io/sample-docs-development/panther/rules/yaml" class="nav-list-link">Rules file (yaml)</a></li>
</ul>
</li>
<li class="nav-list-item"><a href="https://vinceoa.github.io/sample-docs-development/panther/views" class="nav-list-link">Views</a></li>
<li class="nav-list-item"><a href="https://vinceoa.github.io/sample-docs-development/panther/api" class="nav-list-link">Api</a></li>
<li class="nav-list-item"><a href="https://vinceoa.github.io/sample-docs-development/panther/admin" class="nav-list-link">Admin</a></li>
<li class="nav-list-item"><a href="https://vinceoa.github.io/sample-docs-development/panther/settings" class="nav-list-link">Settings</a></li>
<li class="nav-list-item"><a href="https://vinceoa.github.io/sample-docs-development/panther/license" class="nav-list-link">License</a></li>
</ul> </nav> <footer class="site-footer"> © 2021 <a href="https://openanswers.co.uk">Open Answers</a> </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Type to Search" aria-label="Search Panther Docs - Development" autocomplete="off"> <label for="search-input" class="search-label"><svg viewbox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//openanswers.co.uk" class="site-button" target="_blank" rel="noopener noreferrer"> Open Answers </a> </li> <li class="aux-nav-list-item"> <a href="//app.panther.support" class="site-button" target="_blank" rel="noopener noreferrer"> app.panther.support </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <div id="main-content" class="main-content" role="main"> <div id="markdown-content">
<ul id="toc" class="section-nav"> <li class="toc-entry toc-h1">
<a href="#overview">Overview</a> <ul> <li class="toc-entry toc-h2"><a href="#processing-order">Processing order</a></li> </ul> </li> <li class="toc-entry toc-h1">
<a href="#details">Details</a> <ul> <li class="toc-entry toc-h2"><a href="#rule-order">Rule Order</a></li> <li class="toc-entry toc-h2">
<a href="#shortcut-helpers">Shortcut helpers</a> <ul> <li class="toc-entry toc-h3"><a href="#syslog_mapping">syslog_mapping</a></li> <li class="toc-entry toc-h3"><a href="#deduplicate">deduplicate</a></li> <li class="toc-entry toc-h3"><a href="#discard--discard_last">discard / discard_last</a></li> </ul> </li> </ul> </li> </ul> <h1 id="overview"> <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a class="anchor" href="#overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>Overview </h1> <p>Rules control how log messages are turned into events. They can be used to discard, de-duplicate or modify the events that appear in the Panther console.</p> <p>Events are received from an external source, processed by user defined rules, and finally stored on the Panther server.</p> <p><img class="plantuml" src="http://www.plantuml.com/plantuml/svg/~h407374617274756d6c0a636c6f756420226576656e7420736f75726365222061732063310a636c6f7564202250616e74686572222061732070616e207b0a20206167656e7420224167656e7422206173206d6f6e0a20206167656e74202252756c6573222061732072756c65730a202064617461626173652073746f726167650a0a7d200a0a6331202d72696768742d3e206d6f6e0a6d6f6e202d72696768742d3e2072756c65730a72756c6573202d72696768742d3e2073746f726167650a40656e64756d6c"></p> <h2 id="processing-order"> <a href="#processing-order" class="anchor-heading" aria-labelledby="processing-order"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a class="anchor" href="#processing-order" aria-hidden="true"><span class="octicon octicon-link"></span></a>Processing order </h2> <p><img class="plantuml" src="http://www.plantuml.com/plantuml/svg/~h407374617274756d6c0a6167656e7420224167656e742052756c6573222061732061310a6167656e742022476c6f62616c2052756c6573222061732061320a6167656e74202247726f75702052756c6573222061732061330a0a6131202d2d3e2061320a6132202d2d3e2061330a40656e64756d6c"></p> <p>The set of <a href="#syslog-mappings">Syslog Mappings</a> are processed first, followed by the <a href="/sample-docs-development/panther/rules/global#global-rules">Global Rules</a> and, finally, any optional <a href="/sample-docs-development/panther/rules/group#group-rules">Groups Rules</a>.</p> <h1 id="details"> <a href="#details" class="anchor-heading" aria-labelledby="details"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a class="anchor" href="#details" aria-hidden="true"><span class="octicon octicon-link"></span></a>Details </h1> <p>Each rule definition is stored in yaml file.</p> <p>A basic rule has a <code class="language-plaintext highlighter-rouge">name</code> followed by a <em>Select</em> verb, such as <code class="language-plaintext highlighter-rouge">match</code>, and an <em>Action</em> verb, such as <code class="language-plaintext highlighter-rouge">discard</code>:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  name: 'Rule name'
  match:
    some_field: value
  discard: true
</code></pre></div></div> <p>Multiple <em>Select</em>s are interpreted as logical “and” operations. This example is equivalent to “<em>Select</em> WHERE <code class="language-plaintext highlighter-rouge">some_field</code> <strong>matches</strong> the regular expression <code class="language-plaintext highlighter-rouge">/value/</code> AND where <code class="language-plaintext highlighter-rouge">other_field</code> <strong>equals</strong> <code class="language-plaintext highlighter-rouge">value</code>”:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  match:
    some_field: !!js/regexp /value/
  equals:
    other_field: value
</code></pre></div></div> <p>Multiple <em>Actions</em> can be specified too:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  discard: true
  stop: true
</code></pre></div></div> <p>A <em>RuleSet</em>, which groups the rules into logical areas, is made up of an array of <em>Rules</em>. These are processed in order, until the last rule is found or a <code class="language-plaintext highlighter-rouge">stop</code> or <code class="language-plaintext highlighter-rouge">stop_ruleset</code> action is encountered:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  - name: 'Rule name'
    match:
      some_field: value
    set:
      new_field: 17

  - name: 'No junk'
    equals:
      my_field: 'linux'
    set:
      that_field: 'Torvalds'
</code></pre></div></div> <p>There are multiple <em>RuleSets</em> used during processing. The <em>Global</em> <em>RuleSet</em> is processed first, followed by any <em>Group</em> rules. Only one group will be matched, based on the <em>Select</em> verbs, and its rules then processed.</p> <p><em>Discard</em> and <em>Dedupe</em> are shortcuts for what end up as rules that are placed before the rest of the <em>RuleSet</em>.</p> <h2 id="rule-order"> <a href="#rule-order" class="anchor-heading" aria-labelledby="rule-order"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a class="anchor" href="#rule-order" aria-hidden="true"><span class="octicon octicon-link"></span></a>Rule Order </h2> <p>Rules are applied in the following order:</p> <ol> <li>Syslog mapping</li> <li>Global discards</li> <li>Global de-duplication</li> <li>Global rules, in order</li> <li>Grouping, and the group rules. (group_order: if required? TODO - check) <ol> <li>discard_first</li> <li>dedupe</li> <li>rules</li> <li>discard_last</li> </ol> </li> <li>Discards that rely on other mappings</li> </ol> <h2 id="shortcut-helpers"> <a href="#shortcut-helpers" class="anchor-heading" aria-labelledby="shortcut-helpers"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a class="anchor" href="#shortcut-helpers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Shortcut helpers </h2> <p>There are some tasks that are repeated frequently, so the most reqular have shortcuts set up to make the rules more succinct.</p> <p>TODO - not clear how or where to use these!</p> <h3 id="syslog_mapping"> <a href="#syslog_mapping" class="anchor-heading" aria-labelledby="syslog_mapping"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a class="anchor" href="#syslog_mapping" aria-hidden="true"><span class="octicon octicon-link"></span></a><code class="language-plaintext highlighter-rouge">syslog_mapping</code> </h3> <p>Takes the syslog levels and maps them to console severities.</p> <ul> <li>This is a required field (TODO - what is?)</li> </ul> <h3 id="deduplicate"> <a href="#deduplicate" class="anchor-heading" aria-labelledby="deduplicate"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a class="anchor" href="#deduplicate" aria-hidden="true"><span class="octicon octicon-link"></span></a><code class="language-plaintext highlighter-rouge">deduplicate</code> </h3> <p>Shortcut for matching on <code class="language-plaintext highlighter-rouge">summary</code> with a regex and replacing it.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> - [ /match/, 'replace' ]
</code></pre></div></div> <p>Or supply a second regex if you want a more specific search replace</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> - [ /match/, /replace_match/, 'replace' ]
</code></pre></div></div> <ul> <li>A match will short-circuit dedupe execution, but continue on to any following rules.</li> </ul> <h3 id="discard--discard_last"> <a href="#discard--discard_last" class="anchor-heading" aria-labelledby="discard--discard_last"><svg viewbox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <a class="anchor" href="#discard--discard_last" aria-hidden="true"><span class="octicon octicon-link"></span></a><code class="language-plaintext highlighter-rouge">discard</code> / <code class="language-plaintext highlighter-rouge">discard_last</code> </h3> <p>Shortcuts for dumping messages, either before or after normal processing.</p> <p>Discard on summary:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  - '/trash/'
</code></pre></div></div> <p>Or write a full rule</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  - name: 'To the bin'
    match:
      summary: /trash/
</code></pre></div></div> <ul> <li>Discard will short-circuit execution.</li> </ul> </div> <hr> <h2 class="text-delta">Table of contents</h2> <ul> <li> <a href="https://vinceoa.github.io/sample-docs-development/panther/rules/agent">Agent rules</a> </li> <li> <a href="https://vinceoa.github.io/sample-docs-development/panther/rules/global">Server Global rules</a> </li> <li> <a href="https://vinceoa.github.io/sample-docs-development/panther/rules/group">Server Group rules</a> </li> <li> <a href="https://vinceoa.github.io/sample-docs-development/panther/rules/schedules">Event schedule selection</a> </li> <li> <a href="https://vinceoa.github.io/sample-docs-development/panther/rules/selection">Event selection</a> </li> <li> <a href="https://vinceoa.github.io/sample-docs-development/panther/rules/yaml">Rules file (yaml)</a> </li> </ul> <hr> <footer> <div style="float: right"> <p class="text-small"> © 2021 <a href="https://openanswers.co.uk">Open Answers</a> </p> </div> <div class="d-flex mt-2"> <p class="text-small text-grey-dk-000 mb-0"> <a href="https://github.com/vinceoa/sample-docs/tree/master/panther/rules/index.md" id="edit-this-page">Edit this page on GitHub.</a> </p> </div> </footer> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
